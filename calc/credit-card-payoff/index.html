<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Card Payoff Calculator</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="/assets/components.js"></script>
    <link rel="stylesheet" href="/assets/common.css">
</head>

<style>
    :root {
        --primary-color: #2196F3;
        --secondary-color: #FF9800;
        --success-color: #4CAF50;
        --surface-color: #ffffff;
        --background-color: #f5f5f5;
        --border-color: #e0e0e0;
    }

    body {
        font-family: system-ui, -apple-system, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: var(--background-color);
        color: #333;
        line-height: 1.6;
    }

    .container {
    width: 100%; /* Ensures the container spans the full width */
    margin: 60px auto;

    padding: 20px;
    }

    .calculator-section,
    .scenarios-section {
        background: var(--surface-color);
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 30px;
        margin-bottom: 30px;
    }

    h1,
    h2 {
        color: #333;
        margin-bottom: 25px;
        text-align: center;
    }

    .input-section {
        max-width: 500px;
        margin: 0 auto 30px;
    }

    .input-group {
        margin-bottom: 20px;
    }

    .input-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #555;
    }

    .input-group input {
        width: 100%;
        padding: 12px;
        border: 2px solid var(--border-color);
        border-radius: 6px;
        font-size: 16px;
        transition: border-color 0.3s;
    }

    .input-group input:focus {
        outline: none;
        border-color: var(--primary-color);
    }

    .calculate-btn {
        width: 100%;
        padding: 14px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .calculate-btn:hover {
        background-color: #1976D2;
    }

    .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .result-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
    }

    .result-card h3 {
        margin: 0 0 10px 0;
        font-size: 16px;
        color: #666;
    }

    .result-value {
        font-size: 24px;
        font-weight: bold;
        color: var(--primary-color);
    }

    .chart-container {
        height: 400px;
        margin-top: 30px;
    }

    .scenarios-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }

    .scenario-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        transition: transform 0.3s;
    }

    .scenario-card:hover {
        transform: translateY(-5px);
    }

    .scenario-card h3 {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 18px;
    }

    .scenario-content p {
        margin: 10px 0;
        display: flex;
        justify-content: space-between;
        color: #666;
    }

    .scenario-content span {
        font-weight: 500;
        color: var(--primary-color);
    }



    .scenario-input {
        margin-bottom: 15px;
        padding: 0 10px;
    }

    .scenario-input label {
        display: inline-block;
        margin-right: 5px;
        color: #666;
    }

    .scenario-input input {
        width: 100px;
        padding: 5px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 14px;
    }

    .scenario-input input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
    }

    .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
    }

    .calculator-section,
    .results-section {
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .input-section {
        max-width: 100%;
        flex-grow: 1;
    }

    .results-section {
        background: var(--surface-color);
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 30px;
    }

    .chart-container {
        margin-top: auto;
        min-height: 300px;
    }

    @media (max-width: 768px) {
        .main-grid {
            grid-template-columns: 1fr;
        }
    }

    h1 {
        text-align: center;
        margin-bottom: 30px;
    }

    h2 {
        font-size: 1.5rem;
        margin-bottom: 20px;
    }


    @media (max-width: 768px) {
        .container {
            padding: 10px;
        }

        .calculator-section,
        .scenarios-section {
            padding: 20px;
        }

        .scenarios-grid {
            grid-template-columns: 1fr;
        }

        .result-value {
            font-size: 20px;
        }
    }
</style>

<script>

    class CreditCardCalculator {
        constructor() {
            this.initializeEventListeners();
            this.initializeChart();
            this.lastValidInputs = null;
        }

        initializeEventListeners() {
            document.getElementById('calculateBtn').addEventListener('click', () => this.calculate());

            // Main inputs validation
            ['balance', 'apr', 'payment'].forEach(id => {
                const input = document.getElementById(id);
                input.addEventListener('input', () => this.validateInput(input));
            });

            // Scenario inputs
            document.getElementById('extraMonthlyInput').addEventListener('input', (e) => {
                if (this.lastValidInputs) {
                    this.recalculateScenario('extra', parseFloat(e.target.value));
                }
            });

            document.getElementById('lumpSumInput').addEventListener('input', (e) => {
                if (this.lastValidInputs) {
                    this.recalculateScenario('lump', parseFloat(e.target.value));
                }
            });
        }

        validateInput(input) {
            const value = parseFloat(input.value);
            if (isNaN(value) || value < 0) {
                input.classList.add('error');
                return false;
            }
            input.classList.remove('error');
            return true;
        }

        formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        formatMonths(totalMonths) {
            const years = Math.floor(totalMonths / 12);
            const months = totalMonths % 12;
            if (years === 0) return `${months} month${months !== 1 ? 's' : ''}`;
            if (months === 0) return `${years} year${years !== 1 ? 's' : ''}`;
            return `${years} year${years !== 1 ? 's' : ''}, ${months} month${months !== 1 ? 's' : ''}`;
        }

        calculateAmortization(balance, annualRate, monthlyPayment) {
            const monthlyRate = annualRate / 100 / 12;
            let currentBalance = balance;
            let month = 0;
            let totalInterest = 0;
            const schedule = [];

            // Validate minimum payment
            const minPayment = (balance * monthlyRate) + 1;
            if (monthlyPayment < minPayment) {
                throw new Error(`Monthly payment must be at least ${this.formatCurrency(minPayment)} to make progress on the debt.`);
            }

            while (currentBalance > 0 && month < 360) {
                const monthlyInterest = currentBalance * monthlyRate;
                const principalPayment = Math.min(monthlyPayment - monthlyInterest, currentBalance);

                totalInterest += monthlyInterest;
                currentBalance -= principalPayment;

                schedule.push({
                    month: month + 1,
                    balance: Math.max(0, currentBalance),
                    interest: monthlyInterest,
                    principal: principalPayment
                });

                month++;

                if (monthlyPayment <= monthlyInterest) {
                    throw new Error("Payment too small to cover monthly interest.");
                }
            }

            return {
                months: month,
                totalInterest: totalInterest,
                totalPaid: balance + totalInterest,
                schedule: schedule
            };
        }

        calculate() {
            try {
                const balance = parseFloat(document.getElementById('balance').value);
                const apr = parseFloat(document.getElementById('apr').value);
                const payment = parseFloat(document.getElementById('payment').value);

                if (!this.validateInputs(balance, apr, payment)) return;

                this.lastValidInputs = { balance, apr, payment };

                const baseResult = this.calculateAmortization(balance, apr, payment);
                this.updateResults(baseResult);
                this.updateChart(baseResult.schedule);
                this.calculateScenarios(balance, apr, payment, baseResult);

            } catch (error) {
                alert(error.message);
            }
        }

        validateInputs(balance, apr, payment) {
            if (isNaN(balance) || balance <= 0) {
                alert('Please enter a valid balance amount.');
                return false;
            }
            if (isNaN(apr) || apr < 0) {
                alert('Please enter a valid APR.');
                return false;
            }
            if (isNaN(payment) || payment <= 0) {
                alert('Please enter a valid monthly payment.');
                return false;
            }
            return true;
        }
        updateResults(result) {
            document.getElementById('timeToPayoff').textContent = this.formatMonths(result.months);
            document.getElementById('totalInterest').textContent = this.formatCurrency(result.totalInterest);
            document.getElementById('totalAmount').textContent = this.formatCurrency(result.totalPaid);

            const payoffDate = new Date();
            payoffDate.setMonth(payoffDate.getMonth() + result.months);
            document.getElementById('payoffDate').textContent =
                payoffDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
        }

        recalculateScenario(type, value) {
            if (!this.lastValidInputs || isNaN(value)) return;

            const { balance, apr, payment } = this.lastValidInputs;
            const baseResult = this.calculateAmortization(balance, apr, payment);

            try {
                if (type === 'extra') {
                    const extraPaymentResult = this.calculateAmortization(balance, apr, payment + value);
                    this.updateScenarioCard('extraPayment', baseResult, extraPaymentResult);
                } else if (type === 'lump') {
                    const reducedBalance = Math.max(0, balance - value);
                    const lumpSumResult = reducedBalance > 0 ?
                        this.calculateAmortization(reducedBalance, apr, payment) :
                        { months: 0, totalInterest: 0, totalPaid: reducedBalance };
                    this.updateScenarioCard('lumpSum', baseResult, lumpSumResult);
                }
            } catch (error) {
                if (type === 'extra') {
                    this.clearScenarioCard('extraPayment');
                } else if (type === 'lump') {
                    this.clearScenarioCard('lumpSum');
                }
            }
        }

        calculateScenarios(balance, apr, payment, baseResult) {
            // Extra monthly payment
            try {
                const extraAmount = parseFloat(document.getElementById('extraMonthlyInput').value) || 0;
                const extraPaymentResult = this.calculateAmortization(balance, apr, payment + extraAmount);
                this.updateScenarioCard('extraPayment', baseResult, extraPaymentResult);
            } catch (error) {
                this.clearScenarioCard('extraPayment');
            }

            // One-time lump sum payment
            try {
                const lumpSum = parseFloat(document.getElementById('lumpSumInput').value) || 0;
                const reducedBalance = Math.max(0, balance - lumpSum);
                const lumpSumResult = reducedBalance > 0 ?
                    this.calculateAmortization(reducedBalance, apr, payment) :
                    { months: 0, totalInterest: 0, totalPaid: reducedBalance };
                this.updateScenarioCard('lumpSum', baseResult, lumpSumResult);
            } catch (error) {
                this.clearScenarioCard('lumpSum');
            }

            // 10% higher payments
            try {
                const increasedResult = this.calculateAmortization(balance, apr, payment * 1.1);
                this.updateScenarioCard('increasePayment', baseResult, increasedResult);
            } catch (error) {
                this.clearScenarioCard('increasePayment');
            }

            // Two-year payoff
            try {
                const twoYearPayment = this.calculatePaymentForTerm(balance, apr, 24);
                const twoYearResult = this.calculateAmortization(balance, apr, twoYearPayment);
                this.updateTwoYearScenario(twoYearPayment, twoYearResult);
            } catch (error) {
                this.clearTwoYearScenario();
            }

            // Balance transfer
            try {
                const transferPayment = Math.ceil(balance / 18);
                const transferResult = this.calculateAmortization(balance, 0, transferPayment);
                this.updateTransferScenario(transferPayment, baseResult, transferResult);
            } catch (error) {
                this.clearTransferScenario();
            }
        }

        calculatePaymentForTerm(balance, apr, months) {
            const monthlyRate = apr / 100 / 12;
            if (monthlyRate === 0) return balance / months;
            return balance * (monthlyRate * Math.pow(1 + monthlyRate, months)) /
                (Math.pow(1 + monthlyRate, months) - 1);
        }

        updateScenarioCard(scenarioId, baseResult, newResult) {
            const element = document.getElementById(scenarioId);
            if (!element) return; // Exit if element doesn't exist

            const timeSpan = element.querySelector('.time');
            const savingsSpan = element.querySelector('.savings');
            const monthsSpan = element.querySelector('.months');

            if (!timeSpan || !savingsSpan || !monthsSpan) return; // Exit if spans don't exist

            const monthsSaved = baseResult.months - newResult.months;
            const interestSaved = baseResult.totalInterest - newResult.totalInterest;

            timeSpan.textContent = this.formatMonths(newResult.months);
            savingsSpan.textContent = this.formatCurrency(interestSaved);
            monthsSpan.textContent = `${monthsSaved} month${monthsSaved !== 1 ? 's' : ''}`;
        }

        updateTwoYearScenario(payment, result) {
            const element = document.getElementById('twoYearPayoff');
            if (!element) return;

            const paymentSpan = element.querySelector('.payment');
            const interestSpan = element.querySelector('.interest');

            if (!paymentSpan || !interestSpan) return;

            paymentSpan.textContent = this.formatCurrency(payment);
            interestSpan.textContent = this.formatCurrency(result.totalInterest);
        }

        updateTransferScenario(payment, baseResult, transferResult) {
            const element = document.getElementById('balanceTransfer');
            if (!element) return;

            const paymentSpan = element.querySelector('.payment');
            const savingsSpan = element.querySelector('.savings');

            if (!paymentSpan || !savingsSpan) return;

            paymentSpan.textContent = this.formatCurrency(payment);
            savingsSpan.textContent =
                this.formatCurrency(baseResult.totalInterest - transferResult.totalInterest);
        }

        clearScenarioCard(scenarioId) {
            const element = document.getElementById(scenarioId);
            if (!element) return;

            const timeSpan = element.querySelector('.time');
            const savingsSpan = element.querySelector('.savings');
            const monthsSpan = element.querySelector('.months');

            if (timeSpan) timeSpan.textContent = '-';
            if (savingsSpan) savingsSpan.textContent = '-';
            if (monthsSpan) monthsSpan.textContent = '-';
        }

        clearTwoYearScenario() {
            const element = document.getElementById('twoYearPayoff');
            if (!element) return;

            const paymentSpan = element.querySelector('.payment');
            const interestSpan = element.querySelector('.interest');

            if (paymentSpan) paymentSpan.textContent = '-';
            if (interestSpan) interestSpan.textContent = '-';
        }

        clearTransferScenario() {
            const element = document.getElementById('balanceTransfer');
            if (!element) return;

            const paymentSpan = element.querySelector('.payment');
            const savingsSpan = element.querySelector('.savings');

            if (paymentSpan) paymentSpan.textContent = '-';
            if (savingsSpan) savingsSpan.textContent = '-';
        }

        initializeChart() {
            const trace = {
                x: [0],
                y: [0],
                mode: 'lines',
                name: 'Balance',
                line: { color: '#2196F3' }
            };

            const layout = {
                title: 'Balance Over Time',
                xaxis: { title: 'Months' },
                yaxis: {
                    title: 'Balance ($)',
                    tickformat: '$,.0f'
                },
                showlegend: false
            };

            Plotly.newPlot('payoffChart', [trace], layout);
        }

        updateChart(schedule) {
            const trace = {
                x: schedule.map(entry => entry.month),
                y: schedule.map(entry => entry.balance),
                mode: 'lines',
                name: 'Balance',
                line: { color: '#2196F3' }
            };

            const layout = {
                title: 'Balance Over Time',
                xaxis: { title: 'Months' },
                yaxis: {
                    title: 'Balance ($)',
                    tickformat: '$,.0f'
                },
                showlegend: false
            };

            Plotly.newPlot('payoffChart', [trace], layout);
        }
    }

    // Initialize the calculator when the DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
        new CreditCardCalculator();
    });

</script>
</head>

<body>
    <!-- Header placeholder -->
    <div id="header-component"></div>

    <div class="container">
        <h1>Credit Card Payoff Calculator</h1>

        <div class="main-grid">
            <!-- Left Column - Inputs -->
            <div class="calculator-section">
                <div class="input-section">
                    <h2>Enter Your Details</h2>
                    <div class="input-group">
                        <label for="balance">Current Credit Card Balance ($)</label>
                        <input type="number" id="balance" min="0" placeholder="Current Balance" value="10000">
                    </div>

                    <div class="input-group">
                        <label for="apr">Annual Percentage Rate (%)</label>
                        <input type="number" id="apr" min="0" max="100" placeholder="APR" value="18.99">
                    </div>

                    <div class="input-group">
                        <label for="payment">Monthly Payment ($)</label>
                        <input type="number" id="payment" min="0" placeholder="Monthly Payment" value="300">
                    </div>

                    <button id="calculateBtn" class="calculate-btn">Calculate Payoff Plan</button>
                </div>
            </div>

            <!-- Right Column - Results -->
            <div class="results-section">
                <h2>Payment Summary</h2>
                <div class="results-grid">
                    <div class="result-card">
                        <h3>Time to Pay Off</h3>
                        <div class="result-value" id="timeToPayoff">-</div>
                    </div>
                    <div class="result-card">
                        <h3>Total Interest</h3>
                        <div class="result-value" id="totalInterest">-</div>
                    </div>
                    <div class="result-card">
                        <h3>Total Amount</h3>
                        <div class="result-value" id="totalAmount">-</div>
                    </div>
                    <div class="result-card">
                        <h3>Payoff Date</h3>
                        <div class="result-value" id="payoffDate">-</div>
                    </div>
                </div>
                <div id="payoffChart" class="chart-container"></div>
            </div>
        </div>

        <!-- Scenarios Section Below -->
        <div class="scenarios-section">
            <h2>Common Scenarios</h2>
            <div class="scenarios-grid">
                <!-- Extra Monthly Payment -->
                <div class="scenario-card">
                    <h3>Extra Monthly Payment</h3>
                    <div class="scenario-input">
                        <label>Additional amount: $</label>
                        <input type="number" class="scenario-amount" id="extraMonthlyInput" value="100" min="0">
                    </div>
                    <div class="scenario-content" id="extraPayment">
                        <p>New payoff time: <span class="time">-</span></p>
                        <p>Interest saved: <span class="savings">-</span></p>
                        <p>Months saved: <span class="months">-</span></p>
                    </div>
                </div>

                <!-- One-Time Payment -->
                <div class="scenario-card">
                    <h3>One-Time Payment</h3>
                    <div class="scenario-input">
                        <label>Lump sum amount: $</label>
                        <input type="number" class="scenario-amount" id="lumpSumInput" value="5000" min="0">
                    </div>
                    <div class="scenario-content" id="lumpSum">
                        <p>New payoff time: <span class="time">-</span></p>
                        <p>Interest saved: <span class="savings">-</span></p>
                        <p>Months saved: <span class="months">-</span></p>
                    </div>
                </div>

                <!-- Increase Payment by 10% -->
                <div class="scenario-card">
                    <h3>Increase Payment by 10%</h3>
                    <div class="scenario-content" id="increasePayment">
                        <p>New payoff time: <span class="time">-</span></p>
                        <p>Interest saved: <span class="savings">-</span></p>
                        <p>Months saved: <span class="months">-</span></p>
                    </div>
                </div>

                <!-- Pay Off in 2 Years -->
                <div class="scenario-card">
                    <h3>Pay Off in 2 Years</h3>
                    <div class="scenario-content" id="twoYearPayoff">
                        <p>Required monthly payment: <span class="payment">-</span></p>
                        <p>Total interest paid: <span class="interest">-</span></p>
                    </div>
                </div>

                <!-- 0% Balance Transfer -->
                <div class="scenario-card">
                    <h3>0% Balance Transfer (18 months)</h3>
                    <div class="scenario-content" id="balanceTransfer">
                        <p>Monthly payment needed: <span class="payment">-</span></p>
                        <p>Interest saved: <span class="savings">-</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer placeholder -->
    <div id="footer-component"></div>
</body>

</html>