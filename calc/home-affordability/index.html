<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Affordability Calculator</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h1, h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #34495e;
            font-weight: 600;
        }

        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        button {
            width: 100%;
            padding: 12px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        .results {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }

        .result-item {
            margin: 10px 0;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            font-size: 16px;
            color: #2c3e50;
        }

        .highlight {
            color: #2ecc71;
            font-weight: bold;
        }

        .scenarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .scenario-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .scenario-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .scenario-result {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Home Affordability Calculator</h1>
        <form id="affordabilityForm">
            <div class="calculator-grid">
                <div class="input-group">
                    <label for="annualIncome">Annual Income ($)</label>
                    <input type="number" id="annualIncome" value="75000" required>
                </div>
                <div class="input-group">
                    <label for="monthlyDebt">Monthly Debt ($)</label>
                    <input type="number" id="monthlyDebt" value="500" required>
                </div>
                <div class="input-group">
                    <label for="downPayment">Down Payment ($)</label>
                    <input type="number" id="downPayment" value="50000" required>
                </div>
                <div class="input-group">
                    <label for="loanTerm">Loan Term (years)</label>
                    <input type="number" id="loanTerm" value="30" required>
                </div>
                <div class="input-group">
                    <label for="interestRate">Interest Rate (%)</label>
                    <input type="number" id="interestRate" step="0.01" value="6.5" required>
                </div>
                <div class="input-group">
                    <label for="propertyTax">Annual Property Tax Rate (%)</label>
                    <input type="number" id="propertyTax" step="0.01" value="1.2" required>
                </div>
                <div class="input-group">
                    <label for="insurance">Annual Insurance Rate (%)</label>
                    <input type="number" id="insurance" step="0.01" value="0.5" required>
                </div>
                <div class="input-group">
                    <label for="otherExpenses">Monthly HOA/Other ($)</label>
                    <input type="number" id="otherExpenses" value="200" required>
                </div>
            </div>
            <button type="submit">Calculate Affordability</button>
        </form>

        <div class="results" id="results">
            <h2>Results</h2>
            <div class="result-item" id="maxHome"></div>
            <div class="result-item" id="monthlyPayment"></div>
            <div class="result-item" id="breakdown"></div>
            <div class="result-item" id="dtiRatio"></div>
        </div>

        <h2>Scenario Analysis</h2>
        <div class="scenarios" id="scenarios">
            <!-- Scenario cards will be populated here -->
        </div>
    </div>

    <script>
        // Calculate on page load with default values
        window.onload = function() {
            calculateAffordability();
        };

        document.getElementById('affordabilityForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateAffordability();
        });

        function calculateAffordability() {
            // Get input values
            const annualIncome = parseFloat(document.getElementById('annualIncome').value);
            const monthlyDebt = parseFloat(document.getElementById('monthlyDebt').value);
            const downPayment = parseFloat(document.getElementById('downPayment').value);
            const loanTerm = parseFloat(document.getElementById('loanTerm').value);
            const interestRate = parseFloat(document.getElementById('interestRate').value) / 100;
            const propertyTaxRate = parseFloat(document.getElementById('propertyTax').value) / 100;
            const insuranceRate = parseFloat(document.getElementById('insurance').value) / 100;
            const otherExpenses = parseFloat(document.getElementById('otherExpenses').value);

            // Monthly calculations
            const monthlyIncome = annualIncome / 12;
            const monthlyRate = interestRate / 12;
            const numberOfPayments = loanTerm * 12;

            // Maximum monthly payment (using 36% DTI ratio for housing expenses)
            const maxMonthlyPaymentForHousing = (monthlyIncome * 0.36) - monthlyDebt;

            // Calculate maximum home price
            const maxHomePrice = calculateMaxHomePrice(maxMonthlyPaymentForHousing, downPayment, interestRate, loanTerm, propertyTaxRate, insuranceRate, otherExpenses);

            // Calculate monthly payment details
            const loanAmount = maxHomePrice - downPayment;
            const monthlyPI = calculateMonthlyPI(loanAmount, interestRate, loanTerm);
            const monthlyTax = (maxHomePrice * propertyTaxRate) / 12;
            const monthlyInsurance = (maxHomePrice * insuranceRate) / 12;
            const totalMonthlyPayment = monthlyPI + monthlyTax + monthlyInsurance + otherExpenses;

            // Calculate DTI ratio
            const dtiRatio = ((totalMonthlyPayment + monthlyDebt) / monthlyIncome) * 100;

            // Display results
            displayResults(maxHomePrice, totalMonthlyPayment, monthlyPI, monthlyTax, monthlyInsurance, otherExpenses, dtiRatio);

            // Calculate and display scenarios
            calculateScenarios(annualIncome, monthlyDebt, downPayment, loanTerm, interestRate, propertyTaxRate, insuranceRate, otherExpenses);
        }

        // Add this after the form submit event listener
document.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', calculateAffordability);
});

function calculateMaxHomePrice(maxMonthlyPayment, downPayment, interestRate, loanTerm, propertyTaxRate, insuranceRate, otherExpenses) {
    // Start with a reasonable initial guess
    let maxHomePrice = (maxMonthlyPayment - otherExpenses) * 12 / (interestRate + propertyTaxRate + insuranceRate);
    
    // Ensure we don't go below the down payment amount
    if (maxHomePrice < downPayment) {
        maxHomePrice = downPayment;
    }

    let step = maxHomePrice / 2;
    let direction = 1;
    let iterations = 0;
    const maxIterations = 50;

    while (step > 100 && iterations < maxIterations) {
        const testPrice = Math.max(downPayment, maxHomePrice + (step * direction));
        const loanAmount = testPrice - downPayment;
        
        if (loanAmount <= 0) {
            break;
        }

        const monthlyPI = calculateMonthlyPI(loanAmount, interestRate, loanTerm);
        const monthlyTax = (testPrice * propertyTaxRate) / 12;
        const monthlyInsurance = (testPrice * insuranceRate) / 12;
        const totalMonthlyPayment = monthlyPI + monthlyTax + monthlyInsurance + otherExpenses;

        if (totalMonthlyPayment > maxMonthlyPayment) {
            direction = -1;
        } else {
            direction = 1;
            maxHomePrice = testPrice;
        }

        step = step / 2;
        iterations++;
    }

    // Ensure the result is not negative
    return Math.max(downPayment, maxHomePrice);
}

function calculateMonthlyPI(loanAmount, interestRate, loanTerm) {
    const monthlyRate = interestRate / 12;
    const numberOfPayments = loanTerm * 12;
    
    if (monthlyRate === 0) {
        return loanAmount / numberOfPayments;
    }
    
    return loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) 
           / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
}

        function displayResults(maxHomePrice, totalMonthlyPayment, monthlyPI, monthlyTax, monthlyInsurance, otherExpenses, dtiRatio) {
            document.getElementById('maxHome').innerHTML = `Maximum Home Price: <span class="highlight">$${maxHomePrice.toFixed(2)}</span>`;
            document.getElementById('monthlyPayment').innerHTML = `Total Monthly Payment: <span class="highlight">$${totalMonthlyPayment.toFixed(2)}</span>`;
            document.getElementById('breakdown').innerHTML = `
                Monthly Breakdown:<br>
                - Principal & Interest: $${monthlyPI.toFixed(2)}<br>
                - Property Tax: $${monthlyTax.toFixed(2)}<br>
                - Insurance: $${monthlyInsurance.toFixed(2)}<br>
                - Other Expenses: $${otherExpenses.toFixed(2)}
            `;
            document.getElementById('dtiRatio').innerHTML = `Debt-to-Income Ratio: <span class="highlight">${dtiRatio.toFixed(1)}%</span>`;
        }

        function calculateScenarios(annualIncome, monthlyDebt, downPayment, loanTerm, interestRate, propertyTaxRate, insuranceRate, otherExpenses) {
            const scenarios = [
                {
                    title: "Income Change Scenario",
                    calculation: () => {
                        const higherIncome = annualIncome * 1.1; // 10% increase
                        const higherMaxPayment = (higherIncome / 12 * 0.36) - monthlyDebt;
                        const higherHomePrice = calculateMaxHomePrice(higherMaxPayment, downPayment, interestRate, loanTerm, propertyTaxRate, insuranceRate, otherExpenses);
                        return `With a 10% income increase: $${higherHomePrice.toFixed(2)}`;
                    }
                },
                {
                    title: "Down Payment Comparison",
                    calculation: () => {
                        const downPayment20 = downPayment * 1.5; // 50% more down payment
                        const maxPayment = (annualIncome / 12 * 0.36) - monthlyDebt;
                        const homePrice20 = calculateMaxHomePrice(maxPayment, downPayment20, interestRate, loanTerm, propertyTaxRate, insuranceRate, otherExpenses);
                        return `With 50% more down payment: $${homePrice20.toFixed(2)}`;
                    }
                },
                {
                    title: "Interest Rate Impact",
                    calculation: () => {
                        const lowerRate = interestRate - 0.005; // 0.5% lower
                        const maxPayment = (annualIncome / 12 * 0.36) - monthlyDebt;
                        const homePriceLower = calculateMaxHomePrice(maxPayment, downPayment, lowerRate, loanTerm, propertyTaxRate, insuranceRate, otherExpenses);
                        return `With 0.5% lower interest rate: $${homePriceLower.toFixed(2)}`;
                    }
                },
                {
                    title: "Loan Term Comparison",
                    calculation: () => {
                        const shorterTerm = 15;
                        const maxPayment = (annualIncome / 12 * 0.36) - monthlyDebt;
                        const homePriceShorter = calculateMaxHomePrice(maxPayment, downPayment, interestRate, shorterTerm, propertyTaxRate, insuranceRate, otherExpenses);
                        return `With 15-year term: $${homePriceShorter.toFixed(2)}`;
                    }
                }
            ];

            const scenariosContainer = document.getElementById('scenarios');
            scenariosContainer.innerHTML = scenarios.map(scenario => `
                <div class="scenario-card">
                    <h3>${scenario.title}</h3>
                    <div class="scenario-result">${scenario.calculation()}</div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>