<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loan Calculator</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      display: flex;
      justify-content: center;
      background-color: #f5f5f5;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      max-width: 1200px;
      width: 100%;
      gap: 20px;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .left, .right {
      padding: 20px;
      background: white;
      border-radius: 8px;
    }
    .left {
      flex: 1;
      min-width: 300px;
    }
    .right {
      flex: 1;
      min-width: 300px;
    }
    .input-group {
      margin-bottom: 20px;
    }
    .input-group label {
      display: block;
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }
    .input-group input {
      width: calc(100% - 16px);
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      background: #f9f9f9;
      border-radius: 4px;
    }
    .table-container {
      overflow-x: auto;
      margin-top: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      white-space: nowrap;
    }
    th, td {
      padding: 12px;
      text-align: right;
      border: 1px solid #ddd;
    }
    th {
      background: #f4f4f4;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    #visualizations {
      margin-top: 20px;
      display: grid;
      gap: 20px;
    }
    .chart-container {
      width: 100%;
      min-height: 300px;
    }
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        padding: 10px;
      }
      .left, .right {
        width: calc(100% - 40px);
      }
      .table-container {
        max-width: 100%;
      }
      #visualizations {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <a href="/" class="logo">
        <span><img src="https://CalculatorsPlus.com/Logo_CalculatorsPlus.png" style="width: 40px"></span>
        <span>CalculatorsPlus</span>
    </a>
    <a href="/" class="back-link">
        <span>‚Üê</span>
        <span>Back to Calculators</span>
    </a>
</header>
  <div class="container">
    <div class="left">
      <h2>Auto Loan Calculator</h2>
      <div class="input-group">
        <label for="loanAmount">Auto Loan Amount ($):</label>
        <input type="number" id="loanAmount" placeholder="Enter loan amount" value="41000">
      </div>
      <div class="input-group">
        <label for="interestRate">Annual Interest Rate (%):</label>
        <input type="number" id="interestRate" step="0.01" placeholder="Enter interest rate" value="5.99">
      </div>
      <div class="input-group">
        <label for="loanTerm">Term of Loan (Years):</label>
        <input type="number" id="loanTerm" placeholder="Enter loan term" value="5">
      </div>
      <div class="input-group">
        <label for="extraPayment">Extra Monthly Payment ($):</label>
        <input type="number" id="extraPayment" placeholder="Enter extra payment (optional)" value="0">
      </div>
      <button onclick="calculateLoan()">Calculate Loan Details</button>
      <div id="results" class="result"></div>
      <div id="visualizations">
        <div id="paymentBreakdown" class="chart-container"></div>
        <div id="balanceChart" class="chart-container"></div>
      </div>
    </div>

    <div class="right">
      <h2>Amortization Schedule</h2>
      <div class="table-container">
        <div id="schedule"></div>
      </div>
    </div>
  </div>

  <script>
    function calculateLoan() {
      const loanAmount = parseFloat(document.getElementById("loanAmount").value);
      const annualInterestRate = parseFloat(document.getElementById("interestRate").value) || 0;
      const loanTerm = parseInt(document.getElementById("loanTerm").value);
      const extraPayment = parseFloat(document.getElementById("extraPayment").value) || 0;

      if (!validateInputs(loanAmount, loanTerm)) return;

      const monthlyRate = annualInterestRate / 12 / 100;
      const numberOfPayments = loanTerm * 12;
      const monthlyPayment = calculateMonthlyPayment(loanAmount, monthlyRate, numberOfPayments);

      const { scheduleData, totalInterest, paymentCount } = generateAmortizationSchedule(
        loanAmount, monthlyPayment, monthlyRate, numberOfPayments, extraPayment
      );

      displayResults(monthlyPayment, totalInterest, loanAmount, paymentCount);
      displaySchedule(scheduleData);
      createVisualizations(scheduleData, loanAmount, totalInterest);
    }

    function validateInputs(loanAmount, loanTerm) {
      if (isNaN(loanAmount) || isNaN(loanTerm) || loanAmount <= 0 || loanTerm <= 0) {
        alert("Please enter valid positive numbers for loan amount and term.");
        return false;
      }
      return true;
    }

    function calculateMonthlyPayment(principal, rate, payments) {
      return rate > 0
        ? principal * rate / (1 - Math.pow(1 + rate, -payments))
        : principal / payments;
    }

    function generateAmortizationSchedule(loanAmount, monthlyPayment, monthlyRate, numberOfPayments, extraPayment) {
      let balance = loanAmount;
      let totalInterest = 0;
      let paymentCount = 0;
      const scheduleData = [];

      while (balance > 0 && paymentCount < numberOfPayments) {
        const interest = balance * monthlyRate;
        const principal = Math.min(balance, monthlyPayment - interest + extraPayment);
        balance = Math.max(0, balance - principal);

        totalInterest += interest;
        
        const paymentDate = new Date();
        paymentDate.setMonth(paymentDate.getMonth() + paymentCount);

        scheduleData.push({
          paymentNumber: paymentCount + 1,
          date: paymentDate,
          payment: monthlyPayment,
          interest: interest,
          principal: principal,
          balance: balance,
          extraPayment: extraPayment
        });

        paymentCount++;
      }

      return { scheduleData, totalInterest, paymentCount };
    }

    function displayResults(monthlyPayment, totalInterest, loanAmount, paymentCount) {
      const totalPayments = totalInterest + loanAmount;
      const monthsSaved = (60 - paymentCount);
      
      document.getElementById("results").innerHTML = `
        <p><strong>Monthly Payment:</strong> $${monthlyPayment.toFixed(2)}</p>
        <p><strong>Total Interest:</strong> $${totalInterest.toFixed(2)}</p>
        <p><strong>Total Amount:</strong> $${totalPayments.toFixed(2)}</p>
        <p><strong>Number of Payments:</strong> ${paymentCount} ${monthsSaved > 0 ? `(${monthsSaved} months saved!)` : ''}</p>
      `;
    }

    function displaySchedule(scheduleData) {
      const scheduleHtml = `
        <table>
          <thead>
            <tr>
              <th>No.</th>
              <th>Due Date</th>
              <th>Payment</th>
              <th>Interest</th>
              <th>Principal</th>
              <th>Balance</th>
              <th>Extra</th>
            </tr>
          </thead>
          <tbody>
            ${scheduleData.map(row => `
              <tr>
                <td>${row.paymentNumber}</td>
                <td>${row.date.toLocaleDateString()}</td>
                <td>$${row.payment.toFixed(2)}</td>
                <td>$${row.interest.toFixed(2)}</td>
                <td>$${row.principal.toFixed(2)}</td>
                <td>$${row.balance.toFixed(2)}</td>
                <td>$${row.extraPayment.toFixed(2)}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      document.getElementById("schedule").innerHTML = scheduleHtml;
    }

    function createVisualizations(scheduleData, loanAmount, totalInterest) {
      const balanceData = scheduleData.map(row => row.balance);
      const paymentNumbers = scheduleData.map(row => row.paymentNumber);

      Plotly.newPlot('paymentBreakdown', [{
        values: [loanAmount, totalInterest],
        labels: ['Principal', 'Interest'],
        type: 'pie',
        hole: 0.4,
        marker: {
          colors: ['#4CAF50', '#ff9800']
        }
      }], {
        title: 'Payment Breakdown',
        height: 300,
        margin: { t: 30, l: 30, r: 30, b: 30 }
      });

      Plotly.newPlot('balanceChart', [{
        x: paymentNumbers,
        y: balanceData,
        type: 'scatter',
        mode: 'lines',
        line: { color: '#4CAF50' }
      }], {
        title: 'Loan Balance Over Time',
        xaxis: { title: 'Payment Number' },
        yaxis: { title: 'Balance ($)' },
        height: 300,
        margin: { t: 30, l: 50, r: 30, b: 50 }
      });
    }

    // Initial calculation
    calculateLoan();
  </script>
</body>
</html>